# üöÄ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

## –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

1. **HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–µ—à –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
2. **Gzip —Å–∂–∞—Ç–∏–µ** - —Å–∂–∞—Ç–∏–µ HTML/CSS/JS
3. **OPcache** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ PHP –∫–æ–¥–∞
4. **Cache busting** - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

---

## 1. HTTP –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Browser Cache)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `.htaccess`

```apache
# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã - 1 –≥–æ–¥
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType text/css "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"

# HTML - 10 –º–∏–Ω—É—Ç
ExpiresByType text/html "access plus 10 minutes"
```

### –¢–∏–ø—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:

- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (jpg, png, svg): 1 –≥–æ–¥
- **CSS/JS**: 1 –º–µ—Å—è—Ü
- **–®—Ä–∏—Ñ—Ç—ã**: 1 –≥–æ–¥
- **HTML**: 10 –º–∏–Ω—É—Ç —Å —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

---

## 2. Gzip —Å–∂–∞—Ç–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞–µ—Ç:
- HTML
- CSS
- JavaScript
- JSON
- XML

**–≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞**: ~70-80%

---

## 3. OPcache (PHP)

### Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```ini
opcache.enable=1
opcache.memory_consumption=128
opcache.max_accelerated_files=10000
opcache.revalidate_freq=60
```

### Development –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```ini
opcache.enable=1
opcache.revalidate_freq=0
opcache.validate_timestamps=1
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API:

**–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞** (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤):
```bash
POST /api/admin/clear-cache.php
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**:
```bash
GET /api/admin/cache-stats.php
```

---

## 4. Cache Busting (–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:

–í—Å–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –≤–µ—Ä—Å–∏–µ–π:
```html
<link rel="stylesheet" href="/assets/css/style.css?v=1.0.0">
<script src="/assets/js/app.js?v=1.0.0"></script>
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏:

–í–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ CSS/JS —Ñ–∞–π–ª–æ–≤!

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `filemtime()` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```php
// –í config.php
define('ASSET_VERSION', getAssetVersion());
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
```

**–í–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å** - –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç–µ CSS/JS, –∏ –±—Ä–∞—É–∑–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑—è—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é!

---

## 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CacheHelper

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```php
require_once __DIR__ . '/helpers/CacheHelper.php';

// –î–ª—è —Å—Ç–∞—Ç–∏–∫–∏ (1 —á–∞—Å)
CacheHelper::setCacheHeaders(3600);

// –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (10 –º–∏–Ω—É—Ç)
CacheHelper::setDynamicHeaders(600);

// –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
CacheHelper::noCache();
```

### ETag –¥–ª—è —É—Å–ª–æ–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:

```php
$content = generateContent();
$etag = CacheHelper::generateETag($content);

// –û—Ç–ø—Ä–∞–≤–∏—Ç 304 –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
CacheHelper::checkETag($etag);

echo $content;
```

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ URL:

```php
// –í —à–∞–±–ª–æ–Ω–∞—Ö
<img src="<?= CacheHelper::asset('/uploads/logo.png') ?>">
// –†–µ–∑—É–ª—å—Ç–∞—Ç: /uploads/logo.png?v=1.0.0
```

---

## 6. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –ß—Ç–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å:
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- –ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–≥–ª–∞–≤–Ω–∞—è, –æ –Ω–∞—Å)
- API –æ—Ç–≤–µ—Ç—ã —Å —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—â–∏–º–∏—Å—è –¥–∞–Ω–Ω—ã–º–∏

### ‚ùå –ß—Ç–æ –ù–ï –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å:
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –§–æ—Ä–º—ã —Å CSRF —Ç–æ–∫–µ–Ω–∞–º–∏
- –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—Å–ª–µ POST –∑–∞–ø—Ä–æ—Å–æ–≤
- API —Å —Ä–µ–∞–ª—Ç–∞–π–º –¥–∞–Ω–Ω—ã–º–∏

### –ü—Ä–∏–º–µ—Ä –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:

```php
class PublicController {
    public function index() {
        // –ö–µ—à–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ 10 –º–∏–Ω—É—Ç
        CacheHelper::setDynamicHeaders(600);
        
        require __DIR__ . '/../views/public.view.php';
    }
}

class ProfileController {
    public function index() {
        // –ó–∞–ø—Ä–µ—â–∞–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        CacheHelper::noCache();
        
        require __DIR__ . '/../views/profile.view.php';
    }
}
```

---

## 7. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ OPcache:

```bash
# –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose exec web php -i | grep opcache
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Gzip:

```bash
curl -H "Accept-Encoding: gzip" -I http://localhost:8080
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫: Content-Encoding: gzip
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∞ –±—Ä–∞—É–∑–µ—Ä–∞:

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
- `Cache-Control`
- `Expires`
- `ETag`

---

## 8. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞

### –ü—Ä–∏ –¥–µ–ø–ª–æ–µ:

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up --build -d

# –û—á–∏—Å—Ç–∏—Ç—å OPcache —á–µ—Ä–µ–∑ API (–∫–∞–∫ –∞–¥–º–∏–Ω)
curl -X POST http://localhost:8080/api/admin/clear-cache.php
```

### –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ CSS/JS:

1. –û–±–Ω–æ–≤–∏—Ç–µ `ASSET_VERSION` –≤ `config.php`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## 9. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ~500 KB
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~2s

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ~150 KB (Gzip)
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏: ~500ms (—Å –∫–µ—à–µ–º)
- PHP execution: ~10ms (OPcache)

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ: ~4x** üöÄ

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ò–∑–º–µ–Ω–µ–Ω–∏—è CSS/JS –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ `ASSET_VERSION` –≤ `config.php`

### –ü—Ä–æ–±–ª–µ–º–∞: OPcache –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: 
```bash
docker-compose exec web php -m | grep opcache
# –ï—Å–ª–∏ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ - –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up --build -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: Gzip –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–¥—É–ª—å –≤–∫–ª—é—á–µ–Ω:
```bash
docker-compose exec web apache2ctl -M | grep deflate
```
