# Функциональность профиля пользователя

## Обзор

Полноценная система управления профилем пользователя с возможностью редактирования данных и смены пароля.

## Файлы

- `src/controllers/ProfileController.php` - Контроллер профиля
- `src/views/profile.view.php` - Представление профиля
- `src/profile.php` - Точка входа

## Возможности

### 1. Просмотр информации профиля

- Имя пользователя
- Email
- Дата регистрации
- Последний вход
- Роль (пользователь/администратор)
- Аватар с первой буквой имени

### 2. Редактирование профиля

- Изменение имени пользователя (3-50 символов)
- Изменение email
- Валидация уникальности (проверка, что имя/email не заняты другими пользователями)
- CSRF защита
- Автоматическое обновление сессии при изменении имени

### 3. Смена пароля

- Проверка текущего пароля
- Установка нового пароля (минимум 8 символов)
- Подтверждение нового пароля
- Хеширование Argon2ID
- Пользователь остается в системе после смены пароля

## Безопасность

- ✅ CSRF токены на всех формах
- ✅ Проверка авторизации (`requireLogin()`)
- ✅ Валидация всех входных данных
- ✅ Prepared statements для SQL запросов
- ✅ Проверка уникальности username/email
- ✅ Проверка текущего пароля перед сменой
- ✅ Хеширование паролей Argon2ID

## Доступ

**URL:** http://localhost:8080/profile

**Требования:** Авторизованный пользователь

## Интеграция

Ссылки на профиль добавлены в:

1. **Главная страница** (`src/index.php`)
   - Клик на аватар в навигации
   - Кнопка "Управление профилем"
   - Карточка "Профиль" в сетке

2. **Админ-панель** (`src/views/admin.view.php`)
   - Ссылка "Профиль" в шапке

## Интерфейс

### Табы

1. **Информация** - Просмотр данных профиля
2. **Редактировать** - Изменение username и email
3. **Сменить пароль** - Изменение пароля

### Дизайн

- Glassmorphism эффекты
- Темная тема с градиентами
- Lucide иконки
- Адаптивный дизайн
- Анимации переходов

## Валидация

### Имя пользователя
- Обязательное поле
- От 3 до 50 символов
- Уникальное (не занято другими пользователями)

### Email
- Обязательное поле
- Валидный email формат
- Уникальный (не занят другими пользователями)

### Пароль
- Минимум 8 символов
- Требуется текущий пароль для смены
- Подтверждение нового пароля

## Сообщения

### Успех
- "Профиль успешно обновлен"
- "Пароль успешно изменен"

### Ошибки
- "Ошибка безопасности (CSRF)"
- "Заполните все поля"
- "Некорректный email"
- "Это имя пользователя уже занято"
- "Этот email уже используется"
- "Неверный текущий пароль"
- "Новые пароли не совпадают"
- "Новый пароль должен быть не менее 8 символов"

## Примеры использования

### Обновление профиля

```php
POST /profile
action=update_profile
csrf_token=...
username=newusername
email=newemail@example.com
```

### Смена пароля

```php
POST /profile
action=change_password
csrf_token=...
current_password=oldpass123
new_password=newpass123
confirm_password=newpass123
```

## Будущие улучшения

- [ ] Загрузка аватара
- [ ] Двухфакторная аутентификация
- [ ] История входов
- [ ] Управление сессиями
- [ ] Удаление аккаунта
- [ ] Экспорт данных
